--------------------------------------------------------
--  File created - Friday-May-26-2017   
--------------------------------------------------------
DROP TABLE "BANKINGDB"."ACCOUNT" cascade constraints;
DROP TABLE "BANKINGDB"."ACCOUNTTYPE" cascade constraints;
DROP TABLE "BANKINGDB"."USERS" cascade constraints;
DROP TABLE "BANKINGDB"."USER_ACCOUNT" cascade constraints;
DROP SEQUENCE "BANKINGDB"."A_SEQ";
DROP SEQUENCE "BANKINGDB"."U_SEQ";
--------------------------------------------------------
--  DDL for Sequence A_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "BANKINGDB"."A_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 10000 CACHE 20 NOORDER  NOCYCLE ;
--------------------------------------------------------
--  DDL for Sequence U_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "BANKINGDB"."U_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 5 START WITH 200 CACHE 20 NOORDER  NOCYCLE ;
--------------------------------------------------------
--  DDL for Table ACCOUNT
--------------------------------------------------------

  CREATE TABLE "BANKINGDB"."ACCOUNT" 
   (	"ACCT_ID" NUMBER, 
	"BALANCE" NUMBER(12,2) DEFAULT 0.0, 
	"TYPE_ID" NUMBER, 
	"OPENED" DATE, 
	"CLOSED" DATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table ACCOUNTTYPE
--------------------------------------------------------

  CREATE TABLE "BANKINGDB"."ACCOUNTTYPE" 
   (	"T_ID" NUMBER, 
	"TYPE_NAME" VARCHAR2(50 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table USERS
--------------------------------------------------------

  CREATE TABLE "BANKINGDB"."USERS" 
   (	"U_ID" NUMBER, 
	"FIRST_NAME" VARCHAR2(20 BYTE), 
	"LAST_NAME" VARCHAR2(20 BYTE), 
	"EMAIL" VARCHAR2(50 BYTE), 
	"PASSWORD" VARCHAR2(50 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Table USER_ACCOUNT
--------------------------------------------------------

  CREATE TABLE "BANKINGDB"."USER_ACCOUNT" 
   (	"USER_ID" NUMBER, 
	"ACCOUNT_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
REM INSERTING into BANKINGDB.ACCOUNT
SET DEFINE OFF;
REM INSERTING into BANKINGDB.ACCOUNTTYPE
SET DEFINE OFF;
Insert into BANKINGDB.ACCOUNTTYPE (T_ID,TYPE_NAME) values (1,'Checking');
Insert into BANKINGDB.ACCOUNTTYPE (T_ID,TYPE_NAME) values (2,'Saving');
Insert into BANKINGDB.ACCOUNTTYPE (T_ID,TYPE_NAME) values (3,'Credit');
REM INSERTING into BANKINGDB.USERS
SET DEFINE OFF;
Insert into BANKINGDB.USERS (U_ID,FIRST_NAME,LAST_NAME,EMAIL,PASSWORD) values (100,'Arthur','Faugue','afaugue','pass');
Insert into BANKINGDB.USERS (U_ID,FIRST_NAME,LAST_NAME,EMAIL,PASSWORD) values (105,'test','test','test','test');
REM INSERTING into BANKINGDB.USER_ACCOUNT
SET DEFINE OFF;
--------------------------------------------------------
--  DDL for Index PK_JOINED
--------------------------------------------------------

  CREATE UNIQUE INDEX "BANKINGDB"."PK_JOINED" ON "BANKINGDB"."USER_ACCOUNT" ("USER_ID", "ACCOUNT_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  DDL for Index PK_ATYPE
--------------------------------------------------------

  CREATE UNIQUE INDEX "BANKINGDB"."PK_ATYPE" ON "BANKINGDB"."ACCOUNTTYPE" ("T_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM" ;
--------------------------------------------------------
--  Constraints for Table ACCOUNT
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."ACCOUNT" ADD PRIMARY KEY ("ACCT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
  ALTER TABLE "BANKINGDB"."ACCOUNT" MODIFY ("OPENED" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table USERS
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."USERS" ADD UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
  ALTER TABLE "BANKINGDB"."USERS" ADD PRIMARY KEY ("U_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
  ALTER TABLE "BANKINGDB"."USERS" MODIFY ("EMAIL" NOT NULL ENABLE);
  ALTER TABLE "BANKINGDB"."USERS" MODIFY ("LAST_NAME" NOT NULL ENABLE);
  ALTER TABLE "BANKINGDB"."USERS" MODIFY ("FIRST_NAME" NOT NULL ENABLE);
  ALTER TABLE "BANKINGDB"."USERS" MODIFY ("U_ID" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table USER_ACCOUNT
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."USER_ACCOUNT" ADD CONSTRAINT "PK_JOINED" PRIMARY KEY ("USER_ID", "ACCOUNT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ACCOUNTTYPE
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."ACCOUNTTYPE" ADD CONSTRAINT "PK_ATYPE" PRIMARY KEY ("T_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "SYSTEM"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ACCOUNT
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."ACCOUNT" ADD CONSTRAINT "FK_ACCT_TYPE" FOREIGN KEY ("TYPE_ID")
	  REFERENCES "BANKINGDB"."ACCOUNTTYPE" ("T_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table USER_ACCOUNT
--------------------------------------------------------

  ALTER TABLE "BANKINGDB"."USER_ACCOUNT" ADD CONSTRAINT "FK_ACCOUNT" FOREIGN KEY ("ACCOUNT_ID")
	  REFERENCES "BANKINGDB"."ACCOUNT" ("ACCT_ID") ENABLE;
  ALTER TABLE "BANKINGDB"."USER_ACCOUNT" ADD CONSTRAINT "FK_USER" FOREIGN KEY ("USER_ID")
	  REFERENCES "BANKINGDB"."USERS" ("U_ID") ENABLE;
--------------------------------------------------------
--  DDL for Trigger A_SEQ_TRIGGER
--------------------------------------------------------

  CREATE OR REPLACE TRIGGER "BANKINGDB"."A_SEQ_TRIGGER" 
BEFORE INSERT ON ACCOUNT
FOR EACH ROW
BEGIN
  IF :NEW.ACCT_ID IS NULL THEN
    SELECT A_SEQ.NEXTVAL INTO :NEW.ACCT_ID FROM DUAL;
  END IF;
END;
/
ALTER TRIGGER "BANKINGDB"."A_SEQ_TRIGGER" ENABLE;
--------------------------------------------------------
--  DDL for Trigger U_SEQ_TRIGGER
--------------------------------------------------------

  CREATE OR REPLACE TRIGGER "BANKINGDB"."U_SEQ_TRIGGER" 
BEFORE INSERT ON USERS
FOR EACH ROW
BEGIN
  IF :NEW.U_ID IS NULL THEN
    SELECT U_SEQ.NEXTVAL INTO :NEW.U_ID FROM DUAL;
  END IF;
END;
/
ALTER TRIGGER "BANKINGDB"."U_SEQ_TRIGGER" ENABLE;
