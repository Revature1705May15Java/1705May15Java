package com.reim.service;

import java.util.ArrayList;


import com.reim.dao.Dao;
import com.reim.dao.DaoImpl;
import com.reim.pojos.Employee;
import com.reim.pojos.Request;
import com.reim.pojos.State_type;



public class Service {
	
	static Dao dao = new DaoImpl();
	final String approved = "Approved";
	final String denied = "Denied";
	final int isManager = 1;
	final int isEmployee = 0;
	
	//Sign in by username and password return employee 
	//with all requests of this employee
	public Employee Signin(String username, String password){
		Employee temp = dao.findEmpByUname(username);
		ArrayList<Request> reqs = new ArrayList<Request>();
		if(temp.getPw().equals(password)){
			reqs= dao.findReqByEmpId(temp.getEmployee_id());
			temp.setEmployee_request(reqs);
			return temp;
		}
		else
			return null;
	}
	
	public Request SubmitReq(Employee e, String purpose, double amount ){
		Request r = dao.addRequest(e, purpose, amount);
		if (r.getRequest_id() != 0){
			return r;
		}
		return null;
	}
	
	public Employee updateInfo(Employee emp, String fname, String lname, String username, String password){
		Employee temp = dao.findEmpByUname(username);
		Service s = new Service();
		if(temp.getUname() == null){
			dao.updateEmployee(emp.getEmployee_id(), fname, lname, username, password);
			return s.Signin(username, password);
		}
		return null;
	}
	public ArrayList<Request> getAllRequests(Employee emp){
			if(emp.getIs_manager()==isManager){
				ArrayList<Request> reqs = dao.getAllRequests();
				return reqs;
			}
		return null;
	}
	public Request approveReq(Employee emp, Request r, String note){
		if(r.getClosed()==null && emp.getIs_manager()==isManager){
			State_type type = dao.findState(approved);
			r = dao.appDenReq(emp, r, type, note);
			return r;
		}
		return null;
	}
	public Request denyReq(Request r){
		if(r.getClosed()==null){
			State_type type = dao.findState(denied);
			r = dao.appDenReq(r, type);
			return r;
		}
		return null;
	}
}
