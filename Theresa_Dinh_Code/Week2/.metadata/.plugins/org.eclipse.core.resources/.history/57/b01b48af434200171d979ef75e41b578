package servicelayer;

import java.time.LocalDateTime;

import dao.BankDao;
import pojos.Account;
import pojos.AccountType;
import pojos.User;

public class BankService 
{
	BankDao dao = new BankDao(); 
	
	// create new User to dao 
	public User addUser(String fn, String ln, String pw, String email)
	{
		User temp = new User(); 
		temp = dao.getUser(email); 
		if(temp != null)
		{
			System.out.println("Username already exists. Try again with a new username."); 
		}
		else
			dao.addUser(fn, ln, pw, email); /////edit later 
		return dao.getUser(email); 
	}
	
	public boolean createAccount(AccountType type, User user)
	{
		Account temp = new Account(); 
		temp.setType(type);
		temp.setDateOpened(LocalDateTime.now());
		temp.addUser(user); //
		
		if(dao.createAccount(temp)) //confirm that db insertion was success first
			return true;
		else
			return false; 
	}
	
	/// TO DO LATER 
	public boolean deleteAccount(Account account)
	{
		dao.deleteAccount(account); 
		return false; 
	}
	
	public double viewBalance(Account account)
	{
		return dao.viewBalance(account);
	}
	
	// TO DO 
	public Account viewAccount()
	{
		return null;
	}
	// TO DO 
	public User viewUser(User user)
	{
		return null; 
	}
	
	// takes amount to be removed from given account balance, returns the new balane
	public boolean withdraw(Account account, double amount)
	{
		double newBalance = dao.viewBalance(account) - amount; 
		newBalance = dao.updateBalance(account, newBalance); 
		account.setBalance(newBalance);
		
		if(dao.viewBalance(account) == account.getBalance())  //check that the balances are correct in both
			return true;
		else
			return false;  
	}
	
	// takes amount to be added to given account balance, returns the new balane
	public boolean deposit(Account account, double amount)
	{
		double newBalance = dao.viewBalance(account) + amount; 
		newBalance = dao.updateBalance(account, newBalance);
		account.setBalance(newBalance);
		
		if(dao.viewBalance(account) == account.getBalance())  //check that the balances are correct in both
			return true;
		else
			return false; 
	}
	
	public boolean transfer(Account from, Account to, double amount)
	{
		if(withdraw(from, amount) & deposit(to, amount))
			return true;
		else
			return false; 
	}
	
}
